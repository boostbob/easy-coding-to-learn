åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¾é åœ¨ main å‡½æ•°ä¸­è°ƒç”¨åŒ…å†…çš„å‡½æ•°ï¼Œæ ¹æ® fmt.Println æ¥ç¡®å®šå‡½æ•°æ˜¯ä¸æ˜¯æŒ‰ç…§é¢„æœŸçš„å·¥ä½œï¼Œè¿™éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œå› ä¸ºå‡½æ•°å¯èƒ½æ˜¯åŒ…å†…å°å†™çš„ç§æœ‰å‡½æ•°ï¼Œå®ƒå¹¶ä¸éœ€è¦æš´éœ²åˆ°å¤–é¢ï¼Œè€Œä¸”å‡½æ•°å¯èƒ½å‹æ ¹ä¸éœ€è¦è¾“å‡ºä»»ä½•ä¸œè¥¿ï¼Œå®ƒåªè¦æŠŠæ•°æ®å¤„ç†å¥½å°±è¡Œäº†ï¼Œæ‰€ä»¥å¾—å­¦ä¼šæ€ä¹ˆæµ‹è¯•ä»£ç çš„æ­£ç¡®æ€§ã€‚

æŠŠä¸Šä¸ªç« èŠ‚çš„ incUpdateScore å‡½æ•°å¤åˆ¶ä¸€ä¸‹ï¼Œæ”¾åˆ° varpointer åŒ…ä¸‹é¢å–å memaddr.goï¼Œå†…å®¹å¦‚ä¸‹:

```go
func incUpdateScore(ptrScore *int) {
  *ptrScore += 2
}
```

åŒæ ·çš„ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª memaddr_test.go çš„æ–‡ä»¶ï¼Œæ³¨æ„ä»¥ _test ç»“å°¾ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹:

```go
func Test_incUpdateScore(t *testing.T) {
  score := 10
  expected := 11
  incUpdateScore(&score)

  if score != expected {
    t.Errorf("æœ‰é—®é¢˜, æœŸæœ› %d, å®é™…æ˜¯ %d", expected, score)
  }
}
```

æ³¨æ„å‡½æ•°åç§°ä»¥ Test å¼€å¤´ï¼Œå‚æ•°ç±»å‹æ˜¯ *testing.Tï¼Œåœ¨å‡½æ•°åç§°ä¸Šå‡ºç°äº†ä¸€æ’å·¥å…·æ ï¼Œç‚¹ run test åï¼Œè¾“å‡ºå¦‚ä¸‹:

![](https://develop-developer.oss-cn-hangzhou.aliyuncs.com/images/MoDKE9hM7X99yzsj9-CIh6Xn7W6AaRtU6066uUNbFJ.png?x-oss-process=style/txt-water)

```
--- FAIL: Test_incUpdateScore (0.00s)
    /Users/wangbo/Desktop/go-demo/07-code-testing/varpointer/memaddr_test.go:11: æœ‰é—®é¢˜, æœŸæœ› 11, å®é™…æ˜¯ 12
FAIL
FAIL  07-code-testing/varpointer  0.465s
FAIL
```

æµ‹è¯•å¤±è´¥äº†ï¼ŒæœŸå¾…åŠ ä¸Š 1ï¼Œç»“æœåŠ äº†2ï¼Œä¿®å¤ä»£ç :

```go
func incUpdateScore(ptrScore *int) {
  *ptrScore++
}
```

ç°åœ¨ç»“æœæ˜¾ç¤º:

```
ok    07-code-testing/varpointer  0.785s
```

è¯´æ˜å‡½æ•°æµ‹è¯•é€šè¿‡äº†ï¼Œåœ¨ç»ˆç«¯ shell ä½¿ç”¨ go test -v ./... ä¾ç„¶æ˜¾ç¤ºæµ‹è¯•é€šè¿‡:

```
07-code-testing[master*] ğŸ go test -v ./...
?   	07-code-testing	[no test files]
=== RUN   Test_incUpdateScore
11
--- PASS: Test_incUpdateScore (0.00s)
PASS
ok  	07-code-testing/varpointer	0.341s
```

å°ç»“ä¸€ä¸‹ï¼Œæµ‹è¯•åŒ…å†…çš„å‡½æ•°æ­¥éª¤:  
1. æ–°å»ºä¸€ä¸ª xx_test.go çš„æ–‡ä»¶
2. æ–°å»ºå‡½æ•° Test_funcNameï¼Œå®ƒçš„å‚æ•° t *testing.T
3. ç¼–å†™æµ‹è¯•ä»£ç 
4. ä½¿ç”¨ go test å‘½ä»¤æ¥è¿è¡Œæµ‹è¯•æ–‡ä»¶

ç°åœ¨æˆ‘ä»¬æ¥å¯¹ incUpdateScore è¿›è¡Œé‡æ„ï¼Œæˆ‘ä»¬å¸Œæœ›é€’å¢çš„åˆ†æ•°æ˜¯ä»¥å‚æ•°çš„å½¢å¼ä¼ è¿›å»:

```go
func incUpdateScore(ptrScore *int, increment int) {
  *ptrScore += increment
}
```

ä¿å­˜æ–‡ä»¶åå‘ç”Ÿ vscode è‡ªåŠ¨è¿è¡Œäº†æµ‹è¯•ï¼Œå¹¶ä¸”æŠ¥å‘Šäº†æµ‹è¯•å¤±è´¥:

```
# 07-code-testing/varpointer [07-code-testing/varpointer.test]
/Users/wangbo/Desktop/go-demo/07-code-testing/varpointer/memaddr_test.go:8:16: not enough arguments in call to incUpdateScore
  have (*int)
  want (*int, int)
FAIL  07-code-testing/varpointer [build failed]
FAIL
```

ç¼–è¯‘éƒ½æ²¡æœ‰é€šè¿‡ï¼Œå› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å‡½æ•°ç­¾åï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¿®æ”¹æµ‹è¯•ä»£ç ï¼Œé‡æ„æµ‹è¯•ä»£ç å¦‚ä¸‹:

```go
func Test_incUpdateScore(t *testing.T) {
  score := 10
  expected := 11
  incUpdateScore(&score, 1)

  if score != expected {
    t.Errorf("æœ‰é—®é¢˜, æœŸæœ› %d, å®é™…æ˜¯ %d", expected, score)
  }
}
```

ä¿å­˜åçœ‹åˆ°æµ‹è¯•é€šè¿‡äº†ï¼Œä¼ å…¥æ­£æ•°å‡½æ•°å·¥ä½œæ­£å¸¸ï¼Œæˆ‘ä»¬æƒ³æµ‹è¯•ä¸€ä¸‹è´Ÿæ•°çš„æƒ…å†µï¼Œä½¿ç”¨ t.Run æ¥åŒ…è£… 2 ä¸ªæµ‹è¯•åœºæ™¯ï¼Œç»§ç»­é‡æ„ä¸º 2 ä¸ªå­æµ‹è¯•ä»£ç å¦‚ä¸‹:

```go
func Test_incUpdateScore(t *testing.T) {
  t.Run("should increment score by + number", func(t *testing.T)  {
    score := 10
    expected := 11
    incUpdateScore(&score, 1)

    if score != expected {
      t.Errorf("æœ‰é—®é¢˜, æœŸæœ› %d, å®é™…æ˜¯ %d", expected, score)
    }
  })

  t.Run("should increment score by - number", func(t *testing.T)  {
    score := 10
    expected := 9
    incUpdateScore(&score, -1)

    if score != expected {
      t.Errorf("æœ‰é—®é¢˜, æœŸæœ› %d, å®é™…æ˜¯ %d", expected, score)
    }
  })
}
```

å†æ¬¡è¿è¡Œæµ‹è¯•ä¹Ÿé€šè¿‡äº†ï¼Œè¯´æ˜å‡½æ•° incUpdateScore å…·æœ‰é¢„æœŸçš„è¡Œä¸ºï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘æ²¡æœ‰æ²¡æœ‰å€ŸåŠ© main å‡½æ•°å’Œ fmt åŒ…å°±å®Œæˆäº†æµ‹è¯•å’Œé‡æ„ã€‚

```
07-code-testing[master*] ğŸ go test -v ./...
?   	07-code-testing	[no test files]
=== RUN   Test_incUpdateScore
=== RUN   Test_incUpdateScore/should_increment_score_by_+_number
=== RUN   Test_incUpdateScore/should_increment_score_by_-_number
--- PASS: Test_incUpdateScore (0.00s)
    --- PASS: Test_incUpdateScore/should_increment_score_by_+_number (0.00s)
    --- PASS: Test_incUpdateScore/should_increment_score_by_-_number (0.00s)
PASS
ok  	07-code-testing/varpointer	0.559s
```

ä½†æ˜¯è¿™ä¸¤ä¸ªæµ‹è¯•åœºæ™¯æœ‰ä¸€äº›é‡å¤æ€§çš„ä»£ç ï¼Œæœ‰ç‚¹è®©äººçˆ½å¯¹ä¸å¯¹ï¼Œå‡½æ•°å°±æ˜¯æ¶ˆé™¤é‡å¤ä»£ç çš„å¥½åŠæ³•ï¼Œæˆ‘ä»¬å†æ¬¡é‡æ„ä¸€ä¸‹ã€‚

```go
func Test_incUpdateScore(t *testing.T) {
	checkEqual := func(t *testing.T, expected, got int) {
		t.Helper()
		if expected != got {
			t.Errorf("æœ‰é—®é¢˜, æœŸæœ› %d, å®é™…æ˜¯ %d", expected, got)
		}
	}

	t.Run("should increment score by + number", func(t *testing.T) {
		score := 10
		incUpdateScore(&score, 1)
		checkEqual(t, 11, score)
	})

	t.Run("should increment score by - number", func(t *testing.T) {
		score := 10
		incUpdateScore(&score, -1)
		checkEqual(t, 9, score)
	})
}
```

åˆšæ‰åˆ›å»ºçš„æµ‹è¯•æ˜¯å•å…ƒæµ‹è¯•ï¼Œgo test è¿˜æ”¯æŒåŸºå‡†æµ‹è¯•ï¼Œè‡ªå®šä¹‰å…¥å£æµ‹è¯•ç­‰ï¼Œä»¥åçš„ç« èŠ‚ä¼šç»å¸¸ç”¨åˆ°æµ‹è¯•ï¼Œéœ€è¦æŒæ¡å®ƒã€‚

æœ¬ç« èŠ‚çš„ä»£ç  [https://github.com/developdeveloper/go-demo/tree/master/07-code-testing](https://github.com/developdeveloper/go-demo/tree/master/07-code-testing)
