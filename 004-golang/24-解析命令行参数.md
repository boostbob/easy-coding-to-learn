æˆ‘ä»¬åœ¨ç»ˆç«¯ shell ä¸‹è¾“å…¥å‘½ä»¤çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šçœ‹åˆ°ä¸€ä¸ªå¸®åŠ©ä¿¡æ¯ï¼Œæ ¹æ®å¸®åŠ©ä¿¡æ¯å¾—çŸ¥è¯¥å‘½ä»¤çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶ä¸”å«æœ‰å¾ˆå¤šå‚æ•°ï¼Œæœ¬ç« å°±æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚



å¦‚ä½•ç›´æ¥è·å–å‘½ä»¤è¡Œçš„å‚æ•°å‘¢? ç³»ç»Ÿ os åŒ…æä¾›äº† os.Argsï¼Œå®ƒæ˜¯ä¸€ä¸ª string çš„æ•°ç»„:

```go
func main() { 
  fmt.Println(os.Args)
}
```

è¾“å…¥å‘½ä»¤è¡Œ go run main.go macos linux windowsï¼Œå°†æ‰“å°å‡ºå¦‚ä¸‹çš„ç»“æœ:

```go
[/var/folders/jw/rpyqrcvd6jb5w9v2lq0pnnpw0000gn/T/go-build203870186/b001/exe/main macos linux windows]
```

å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å‘½ä»¤æœ¬èº«ï¼Œç¬¬äºŒéƒ¨åˆ†æ‰æ˜¯å‚æ•°ã€‚



é€šå¸¸å…¸å‹çš„ä¸€ä¸ªå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯æœ‰ä»¥ä¸‹å½¢å¼:  
1. cmd -h 
2. cmd --help  
3. cm -?  



è™½ç„¶ os.Args èƒ½æä¾›å‘½ä»¤è¡Œçš„ä¿¡æ¯ï¼Œä½†å¦‚æœè‡ªè¡Œå»è§£æè¿™ä¸ªå‚æ•°ï¼Œé‚£å°±å¤ªå¤æ‚äº†ã€‚go å†…ç½®çš„åŒ… flag å¯ä»¥æŠŠè¿™ä»¶äº‹åšå¥½ï¼Œflag åŒ…å¯¹å‘½ä»¤å‚æ•°çš„ç±»å‹åšäº†å®šä¹‰:  
1. å¸ƒå°”å‘½ä»¤  
2. å­—ç¬¦ä¸²  
3. æ•°å€¼



æ¯”å¦‚æ‰“å°å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯å°±æ˜¯ä¸€ä¸ªå¼€å…³ï¼Œå¦‚æœå‘½ä»¤è¡Œä¼ é€’äº† -hã€--helpã€-? ç­‰å°±è®¤ä¸ºæ˜¯è¦æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå®ç°æ–¹å¼åˆ†ä¸º 2 æ­¥:  
1. å®šä¹‰ç»‘å®šå‘½ä»¤å‚æ•°çš„å˜é‡  
2. è°ƒç”¨ flag.Parse è§£æ  

```go
func main() { 
  flag.BoolVar(&help, "h", false, "show help") 
  flag.Parse()
}
```

flag.BoolVar è¡¨ç¤ºè¦ç»‘å®š h å‘½ä»¤å‚æ•°åˆ° help å˜é‡ä¸Šï¼Œç¬¬ä¸‰ä¸ªå‚æ•° false è¡¨ç¤ºè¯¥å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¦‚æœå‘½ä»¤è¡Œæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œhelp=falseï¼Œæœ‰äº† help å˜é‡å°±å¥½åŠäº†ï¼Œå¦‚æœ help ä¸º trueï¼Œå°±æ‰“å°å¸®åŠ©ä¿¡æ¯ï¼Œé€€å‡º:

```go
if help { 
  usage() 
  return
}

func usage() {
  // 
}
```

è¾“å…¥ go run main.go --help çœ‹çœ‹æ˜¾ç¤º:

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --help
Usage of /var/folders/jw/rpyqrcvd6jb5w9v2lq0pnnpw0000gn/T/go-build694631870/b001/exe/main:
  -h	show help
```
  
è‡ªåŠ¨æ‰“å°é™¤äº† -h çš„å¸®åŠ©ä¿¡æ¯ï¼Œå†åŠ ä¸€ä¸ªç»‘å®š --color çœ‹çœ‹æ•ˆæœ:

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --help
Usage of /var/folders/jw/rpyqrcvd6jb5w9v2lq0pnnpw0000gn/T/go-build632569444/b001/exe/main:
  -color
    	apply color display
  -h	show help
```

è¿™æ˜¯å› ä¸ºé»˜è®¤æ‰“å°çš„æ˜¯ flag.Usage() å‡½æ•°çš„ç»“æœï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œçš„ usage å‡½æ•°ä»€ä¹ˆéƒ½æ²¡å¹²ï¼Œå¦‚æœéœ€è¦æ›¿æ¢æ‰ flag.Usage() é»˜è®¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¯ä»¥ç®€å•çš„æŠŠ flag.Usage å‡½æ•°åœ°å€æ¢æ‰å°±è¡Œäº†:

```go
flag.Usage = usage
flag.Parse()

if help { 
  return 
}
```

è¿è¡Œ go run main.go --help æ˜¾ç¤º:

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --help

ä½ å¥½ï¼Œè¿™æ˜¯è‡ªå®šä¹‰å¸®åŠ©ä¿¡æ¯
```

è¿™æ ·çš„å¸®åŠ©ä¿¡æ¯æ²¡æœ‰å‚æ•°ç”¨æ³•ï¼Œå¯ä»¥ä½¿ç”¨ flag.PrintDefaults() å‡½æ•°æ‰¾å›æ¥ï¼Œä¿®æ”¹ usage å‡½æ•°å¦‚ä¸‹:

```go
func usage() { 
  fmt.Fprintf(os.Stderr, "ä½ å¥½ï¼Œè¿™æ˜¯è‡ªå®šä¹‰å¸®åŠ©ä¿¡æ¯\n") 
  flag.PrintDefaults()
}
```

ç°åœ¨è¿è¡Œ  go run main.go --help å°±å®Œç¾äº†:

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --help
ä½ å¥½ï¼Œè¿™æ˜¯è‡ªå®šä¹‰å¸®åŠ©ä¿¡æ¯  
  -color
    	apply color display
  -h	show help
```

åŒç†ï¼Œå¢åŠ ä¸€ä¸ª hours å‚æ•°ï¼Œå¹¶ä¸”å…·æœ‰é»˜è®¤æ˜¯:

```go
flag.IntVar(&hours, "hours", 24, "date time mode")

// ...
if hours == 24 { 
  fmt.Println("23:59:59")
} else { 
  fmt.Println("not 24 hours mode")
}
```

è¿è¡Œ go run main.go å’Œ go run main.go --hours=24ã€go run main.go --hours 24 éƒ½æ˜¾ç¤º 23:59:59ï¼Œå…¶ä»–çš„ hours å‚æ•°ä¼šåˆ™æ‰“å°æç¤º:

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --hours 12
not 24 hours mode
```

å¯¹äº flag.IntVar è¿™ç§æŒ‡é’ˆå®šä¹‰å½¢å¼ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„å†™æ³•:

```go
var hours = flag.Int("hours", 24, "date time mode")
```

å¯¹ string çš„ç»‘å®šä½¿ç”¨ flag.StringVarï¼Œç›¸ä¿¡ä½ ä¹Ÿä¼šäº†ã€‚éœ€è¦æ³¨æ„çš„å‚æ•°å½¢å¼æ˜¯ -flag å½¢å¼æ”¯æŒ boolï¼Œ-flag x åªæ”¯æŒéboolï¼Œè€Œ -flag éƒ½æ”¯æŒã€‚



å¦‚æœæƒ³è§£æ --fruits "apple,orange,banana" æ€ä¹ˆåšå‘¢? ç®€å•ï¼Œç”¨ StringVar å•Šï¼Œæ²¡é”™ï¼Œä½†æ˜¯ StringVar åªèƒ½å¾—åˆ° fruits=apple,orange,bananaï¼Œæˆ‘å¸Œæœ›ç›´æ¥è§£ææˆåˆ‡ç‰‡ fruits=[]string{"apple", "orange", "banana"} æ€ä¹ˆåŠ? flag æä¾›äº†çµæ´»æ€§ï¼Œå¯ä»¥ä½¿ç”¨ flag.Var æ¥è‡ªå®šä¹‰ï¼Œä¸è¿‡è¿™ç§è‡ªå®šä¹‰çš„ç±»å‹å¿…é¡»å®ç° flag.Value æ¥å£ï¼Œå®ƒçš„è¦æ±‚æ˜¯:

```go
type Value interface { 
  String() string 
  Set(string) error
}
```

å®ç°ä¸€ä¸ªè§£æ fruits å‚æ•°çš„ç±»å‹:

```go
type sliceArg []string

// æ„é€ å‡½æ•°, def å®ç°äº†é»˜è®¤å€¼
func New(p *[]string, def []string) *sliceArg {
  *p = def
  return (*sliceArg)(p)
}

func (s *sliceArg) Set(val string) error {
  *s = sliceArg(strings.Split(val, ","))
  return nil
}

func (s *sliceArg) String() string { return strings.Join(*s, ",") }
```

ç”¨æ³•:

```go
flag.Var(New(&fruits, []string{"nothing"}), "fruits", "do you like sth")

//...
fmt.Println(fruits)
```

ç°åœ¨è¿è¡Œ go run main.go æ˜¾ç¤º fruits  çš„å€¼æ˜¯ [nothing]ï¼Œè€Œ go run main.go --fruits "apple,orange" çš„å€¼çš„è¿˜æ˜¯ [apple orange]ï¼ŒæŠŠ "apple,orange" æˆæœçš„è§£æåˆ°äº† []string åˆ‡ç‰‡ç±»å‹ã€‚

```go
24-parse-cmd-flags[master*] ğŸ go run main.go --fruits "apple,orange"
23:59:59
[apple orange]


24-parse-cmd-flags[master*] ğŸ go run main.go
23:59:59
[nothing]
```

æœ¬ç« èŠ‚çš„ä»£ç  [https://github.com/developdeveloper/go-demo/tree/master/24-parse-cmd-flags](https://github.com/developdeveloper/go-demo/tree/master/24-parse-cmd-flags)
