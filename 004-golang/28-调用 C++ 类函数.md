CGO ä¸èƒ½ç›´æ¥æ”¯æŒ C++ï¼Œåªèƒ½é  C æ¥å«æ¥ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æ”¯æŒ C++ç‰¹æœ‰çš„ç±»å‹ï¼Œæ¯”å¦‚å¼•ç”¨å‚æ•°ã€å¯¹è±¡ç±»ã€‚å¦‚æœæŠŠä¸Šä¸€ç« èŠ‚çš„ Say å‡½æ•°ä½¿ç”¨ C++ å®ç°ï¼Œå…¶å®å’Œ Cã€C++ é…åˆæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¸»è¦ä½¿ç”¨ extern "C" è®© cpp ç”Ÿæˆçš„å‡½æ•°ç¬¦åˆ C çš„è°ƒç”¨è§„èŒƒï¼Œä»£ç å¦‚ä¸‹:

```go
// say.h
void Say(const char* s);

// say.cpp
#include <iostream>

extern "C" {
    #include "say.h"
}

void Say(const char* s) {
    std::cout << s;
}

// main.go 
package main

//#include "say.h"
import "C"

func main() {
  C.Say(C.CString("hi, cgo"))
}
```

ä½†æ˜¯ä½¿ç”¨ C++ç±»å°±ä¸åŒäº†ï¼Œå…ˆè¯´ç»“è®ºï¼Œä½¿ç”¨ cgo ä½¿ç”¨ C++çš„æ­¥éª¤:

1. ç”¨çº¯ C æ¥åŒ…è£… C++ çš„ç±»å¯¹è±¡è¡Œä¸º

2. å°†åŒ…è£…çš„ C å‡½æ•°æ˜ å°„åˆ° Go çš„å‡½æ•°

3. è°ƒç”¨ Go çš„åŒ…è£…å‡½æ•°



ä¸‹é¢ä¸¾ä¾‹ï¼Œé¦–å…ˆå†™ä¸€ä¸ª Person çš„ C++ ç±»(ä½¿ç”¨ struct)ï¼Œæœ‰ 2 ä¸ªå±æ€§(nameã€age)å’Œä¸€ä¸ª æ–¹æ³•(Say):

```cpp
//person.h

#define _GLIBCXX_USE_CXX11_ABI 0 // ç¦ç”¨ C++ 11 çš„æ–°ç±»

#include <iostream>
#include <string>

using namespace std;

struct Person
{
private:
  string name;
  int age;

public:
  Person(string name, int age);
  void Say();
};

Person::Person(string name, int age)
{
  this->name = name;
  this->age = age;
}

void Person::Say()
{
  cout << "name: " << this->name << ", age: " << this->age;
}
```

ç¬¬äºŒæ­¥ï¼Œç¼–å†™åŒ…è£…çš„ C å‡½æ•°ï¼Œå®šä¹‰äº† C çš„ç±»å‹ Person_Tï¼ŒæŠŠåˆ›å»ºå¯¹è±¡ã€è°ƒç”¨ Sayã€é‡Šæ”¾å¯¹è±¡éƒ½å®šä¹‰äº† C  é£æ ¼çš„å‡½æ•°:

```c
// person_cgo.h

typedef struct Person_T Person_T;

Person_T* NewPerson(const char* name, int age);
void PersonSay(Person_T *person);
void DeletePerson(Person_T* person);
```

ç¬¬ä¸‰æ­¥ï¼Œåœ¨ cpp æ–‡ä»¶é‡Œä½¿å®ç° C çš„å‡½æ•°ï¼Œæ³¨æ„æ–°çš„ç±»å‹ Person_T ç»§æ‰¿ C++ ç±»å‹ Person:

```cpp
// person_cgo.cpp

#include "person.h"

extern "C"
{
#include "person_cgo.h"
}

struct Person_T : Person
{
  Person_T(const char *name, int age) : Person(name, age) {}
  ~Person_T() {}
};

Person_T *NewPerson(const char *name, int age)
{
  return new Person_T(name, age);
}

void PersonSay(Person_T *person)
{
  person->Say();
}

void DeletePerson(Person_T *person)
{
  delete person;
}
```

ç¬¬ä¸‰æ­¥ï¼Œå°±æ˜¯ä½¿ç”¨ import "C" æ¥è°ƒç”¨äº†ï¼Œå®šä¹‰äº† CGO_NewPersonã€CGO_PersonSayã€CGO_DeletePerson æ¥æ˜ å°„:

```go
// main.go

package main

//#include "person_cgo.h"
import "C"

type CGO_Person_T = C.Person_T

func CGO_NewPerson(name string, age int) *CGO_Person_T {
  return C.NewPerson(C.CString(name), C.int(age))
}

func CGO_PersonSay(person *CGO_Person_T) {
  C.PersonSay(person)
}

func CGO_DeletePerson(person *CGO_Person_T) {
  C.DeletePerson(person)
}

func main() {
  person := CGO_NewPerson("zhangsan", 20)
  CGO_PersonSay(person)
  CGO_DeletePerson(person)
}
```

æ‰§è¡Œ go run . æ˜¾ç¤º:

```bash
callcppclass[master*] ğŸ go run .
name: zhangsan, age: 20
```


æœ¬ç« èŠ‚çš„ä»£ç  [https://github.com/developdeveloper/go-demo/tree/master/28-call-cplusplus-module](https://github.com/developdeveloper/go-demo/tree/master/28-call-cplusplus-module)
